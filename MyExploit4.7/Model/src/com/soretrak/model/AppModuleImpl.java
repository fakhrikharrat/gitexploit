package com.soretrak.model;

import com.soretrak.model.common.AppModule;
import com.soretrak.model.eo.TripsImpl;
import com.soretrak.model.eo.TripsplanImpl;
import com.soretrak.model.view.ListLinesGrpViewImpl;
import com.soretrak.model.view.ListStationPlanImpl;
import com.soretrak.model.view.ListStationTimeViewImpl;
import com.soretrak.model.vo.DaysplanViewImpl;
import com.soretrak.model.vo.DrdmdlocViewImpl;
import com.soretrak.model.vo.DrligneViewImpl;


import com.soretrak.model.vo.TripsViewImpl;
import com.soretrak.model.vo.TripsViewRowImpl;
import com.soretrak.model.vo.TripsplanViewImpl;

import com.soretrak.model.vo.TripsplanViewRowImpl;

import java.sql.Timestamp;

import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;


import oracle.jbo.AttributeDef;
import oracle.jbo.Key;
import oracle.jbo.domain.Date;

import oracle.jbo.Row;
import oracle.jbo.VariableValueManager;
import oracle.jbo.ViewCriteria;
import oracle.jbo.ViewObject;
import oracle.jbo.domain.DBSequence;
import oracle.jbo.server.ApplicationModuleImpl;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.server.EntityDefImpl;
import oracle.jbo.server.ViewLinkImpl;
import oracle.jbo.server.ViewObjectImpl;

// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Tue May 10 15:02:26 UTC 2016
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class AppModuleImpl extends ApplicationModuleImpl implements AppModule {
    /**
     * This is the default constructor (do not remove).
     */
    public AppModuleImpl() {
    }

    /**
     * Container's getter for DrligneView1.
     * @return DrligneView1
     */
    public DrligneViewImpl getDrligneView1() {
        return (DrligneViewImpl) findViewObject("DrligneView1");
    }

    /**
     * Container's getter for DritinView2.
     * @return DritinView2
     */
    public ViewObjectImpl getDritinView2() {
        return (ViewObjectImpl) findViewObject("DritinView2");
    }

    /**
     * Container's getter for DradaptView3.
     * @return DradaptView3
     */
    public ViewObjectImpl getDradaptView3() {
        return (ViewObjectImpl) findViewObject("DradaptView3");
    }

    /**
     * Container's getter for Drdpla1View4.
     * @return Drdpla1View4
     */
    public ViewObjectImpl getDrdpla1View4() {
        return (ViewObjectImpl) findViewObject("Drdpla1View4");
    }

    /**
     * Container's getter for DrdetprView3.
     * @return DrdetprView3
     */
    public ViewObjectImpl getDrdetprView3() {
        return (ViewObjectImpl) findViewObject("DrdetprView3");
    }

    /**
     * Container's getter for DrdplanView4.
     * @return DrdplanView4
     */
    public ViewObjectImpl getDrdplanView4() {
        return (ViewObjectImpl) findViewObject("DrdplanView4");
    }

    /**
     * Container's getter for GroupContView1.
     * @return GroupContView1
     */
    public ViewObjectImpl getGroupContView1() {
        return (ViewObjectImpl) findViewObject("GroupContView1");
    }

    /**
     * Container's getter for ControleView2.
     * @return ControleView2
     */
    public ViewObjectImpl getControleView2() {
        return (ViewObjectImpl) findViewObject("ControleView2");
    }

    /**
     * Container's getter for RapportContView1.
     * @return RapportContView1
     */
    public ViewObjectImpl getRapportContView1() {
        return (ViewObjectImpl) findViewObject("RapportContView1");
    }

    /**
     * Container's getter for SuiviRapportView1.
     * @return SuiviRapportView1
     */
    public ViewObjectImpl getSuiviRapportView1() {
        return (ViewObjectImpl) findViewObject("SuiviRapportView1");
    }

    /**
     * Container's getter for PlanContView2.
     * @return PlanContView2
     */
    public ViewObjectImpl getPlanContView2() {
        return (ViewObjectImpl) findViewObject("PlanContView2");
    }

    /**
     * Container's getter for DritinView3.
     * @return DritinView3
     */
    public ViewObjectImpl getDritinView3() {
        return (ViewObjectImpl) findViewObject("DritinView3");
    }

    /**
     * Container's getter for TypeContView1.
     * @return TypeContView1
     */
    public ViewObjectImpl getTypeContView1() {
        return (ViewObjectImpl) findViewObject("TypeContView1");
    }

    /**
     * Container's getter for AgencyView1.
     * @return AgencyView1
     */
    public ViewObjectImpl getAgencyView1() {
        return (ViewObjectImpl) findViewObject("AgencyView1");
    }

    /**
     * Container's getter for CalendarView1.
     * @return CalendarView1
     */
    public ViewObjectImpl getCalendarView1() {
        return (ViewObjectImpl) findViewObject("CalendarView1");
    }

    /**
     * Container's getter for TripsView1.
     * @return TripsView1
     */
    public TripsViewImpl getTripsView1() {
        return (TripsViewImpl) findViewObject("TripsView1");
    }

    /**
     * Container's getter for StopTimesView1.
     * @return StopTimesView1
     */
    public ViewObjectImpl getStopTimesView1() {
        return (ViewObjectImpl) findViewObject("StopTimesView1");
    }

    /**
     * Container's getter for TripsView2.
     * @return TripsView2
     */
    public TripsViewImpl getTripsView2() {
        return (TripsViewImpl) findViewObject("TripsView2");
    }

    /**
     * Container's getter for StopTimesView2.
     * @return StopTimesView2
     */
    public ViewObjectImpl getStopTimesView2() {
        return (ViewObjectImpl) findViewObject("StopTimesView2");
    }

    /**
     * Container's getter for StopTimesView3.
     * @return StopTimesView3
     */
    public ViewObjectImpl getStopTimesView3() {
        return (ViewObjectImpl) findViewObject("StopTimesView3");
    }

    /**
     * Container's getter for Dritin1View2.
     * @return Dritin1View2
     */
    public ViewObjectImpl getDritin1View2() {
        return (ViewObjectImpl) findViewObject("Dritin1View2");
    }

    /**
     * Container's getter for DrstatiView1.
     * @return DrstatiView1
     */
    public ViewObjectImpl getDrstatiView1() {
        return (ViewObjectImpl) findViewObject("DrstatiView1");
    }

    /**
     * Container's getter for GroupExpView1.
     * @return GroupExpView1
     */
    public ViewObjectImpl getGroupExpView1() {
        return (ViewObjectImpl) findViewObject("GroupExpView1");
    }

    /**
     * Container's getter for TripsView3.
     * @return TripsView3
     */
    public TripsViewImpl getTripsView3() {
        return (TripsViewImpl) findViewObject("TripsView3");
    }

    /**
     * Container's getter for ListLinesGrpView1.
     * @return ListLinesGrpView1
     */
    public ListLinesGrpViewImpl getListLinesGrpView1() {
        return (ListLinesGrpViewImpl) findViewObject("ListLinesGrpView1");
    }

    /**
     * Container's getter for StopTimesView4.
     * @return StopTimesView4
     */
    public ViewObjectImpl getStopTimesView4() {
        return (ViewObjectImpl) findViewObject("StopTimesView4");
    }

    /**
     * Container's getter for ListStationTimeView1.
     * @return ListStationTimeView1
     */
    public ListStationTimeViewImpl getListStationTimeView1() {
        return (ListStationTimeViewImpl) findViewObject("ListStationTimeView1");
    }

    /**
     * Container's getter for DrcentrView1.
     * @return DrcentrView1
     */
    public ViewObjectImpl getDrcentrView1() {
        return (ViewObjectImpl) findViewObject("DrcentrView1");
    }

    /**
     * Container's getter for GroupExpView2.
     * @return GroupExpView2
     */
    public ViewObjectImpl getGroupExpView2() {
        return (ViewObjectImpl) findViewObject("GroupExpView2");
    }

    /**
     * Container's getter for TripsView4.
     * @return TripsView4
     */
    public TripsViewImpl getTripsView4() {
        return (TripsViewImpl) findViewObject("TripsView4");
    }

    /**
     * Container's getter for StopTimesView5.
     * @return StopTimesView5
     */
    public ViewObjectImpl getStopTimesView5() {
        return (ViewObjectImpl) findViewObject("StopTimesView5");
    }


    /**
     * Container's getter for DrdelegView2.
     * @return DrdelegView2
     */
    public ViewObjectImpl getDrdelegView2() {
        return (ViewObjectImpl) findViewObject("DrdelegView2");
    }

    /**
     * Container's getter for DrligneView2.
     * @return DrligneView2
     */
    public DrligneViewImpl getDrligneView2() {
        return (DrligneViewImpl) findViewObject("DrligneView2");
    }

    /**
     * Container's getter for DrvehicView1.
     * @return DrvehicView1
     */
    public ViewObjectImpl getDrvehicView1() {
        return (ViewObjectImpl) findViewObject("DrvehicView1");
    }

    /**
     * Container's getter for TripsplanView3.
     * @return TripsplanView3
     */
    public TripsplanViewImpl getTripsplanView3() {
        return (TripsplanViewImpl) findViewObject("TripsplanView3");
    }

    /**
     * Container's getter for TripsplanView1.
     * @return TripsplanView1
     */
    public TripsplanViewImpl getTripsplanView1() {
        return (TripsplanViewImpl) findViewObject("TripsplanView1");
    }

    /**
     * Container's getter for DragentView1.
     * @return DragentView1
     */
    public ViewObjectImpl getDragentView1() {
        return (ViewObjectImpl) findViewObject("DragentView1");
    }

    /**
     * Container's getter for DaysplanView1.
     * @return DaysplanView1
     */
    public DaysplanViewImpl getDaysplanView1() {
        return (DaysplanViewImpl) findViewObject("DaysplanView1");
    }

    /**
     * Container's getter for TripsplanView2.
     * @return TripsplanView2
     */
    public TripsplanViewImpl getTripsplanView2() {
        return (TripsplanViewImpl) findViewObject("TripsplanView2");
    }

    /**
     * Container's getter for NewDritinDrligneVL.
     * @return NewDritinDrligneVL
     */
    public ViewLinkImpl getNewDritinDrligneVL() {
        return (ViewLinkImpl) findViewLink("NewDritinDrligneVL");
    }

    /**
     * Container's getter for NewDradaptDerligneVL1.
     * @return NewDradaptDerligneVL1
     */
    public ViewLinkImpl getNewDradaptDerligneVL1() {
        return (ViewLinkImpl) findViewLink("NewDradaptDerligneVL1");
    }

    /**
     * Container's getter for NewDrdpla1DrligneVL1.
     * @return NewDrdpla1DrligneVL1
     */
    public ViewLinkImpl getNewDrdpla1DrligneVL1() {
        return (ViewLinkImpl) findViewLink("NewDrdpla1DrligneVL1");
    }

    /**
     * Container's getter for Newdrdpla1DRDETPRVL2.
     * @return Newdrdpla1DRDETPRVL2
     */
    public ViewLinkImpl getNewdrdpla1DRDETPRVL2() {
        return (ViewLinkImpl) findViewLink("Newdrdpla1DRDETPRVL2");
    }

    /**
     * Container's getter for FkDrdplanRef10708Drdpla1Link2.
     * @return FkDrdplanRef10708Drdpla1Link2
     */
    public ViewLinkImpl getFkDrdplanRef10708Drdpla1Link2() {
        return (ViewLinkImpl) findViewLink("FkDrdplanRef10708Drdpla1Link2");
    }

    /**
     * Container's getter for FKgroupControleVL1.
     * @return FKgroupControleVL1
     */
    public ViewLinkImpl getFKgroupControleVL1() {
        return (ViewLinkImpl) findViewLink("FKgroupControleVL1");
    }

    /**
     * Container's getter for SysC00201801Link2.
     * @return SysC00201801Link2
     */
    public ViewLinkImpl getSysC00201801Link2() {
        return (ViewLinkImpl) findViewLink("SysC00201801Link2");
    }

    /**
     * Container's getter for SysC00201803Link1.
     * @return SysC00201803Link1
     */
    public ViewLinkImpl getSysC00201803Link1() {
        return (ViewLinkImpl) findViewLink("SysC00201803Link1");
    }

    /**
     * Container's getter for GroupPlanVL1.
     * @return GroupPlanVL1
     */
    public ViewLinkImpl getGroupPlanVL1() {
        return (ViewLinkImpl) findViewLink("GroupPlanVL1");
    }

    /**
     * Container's getter for NewPlanItinVL1.
     * @return NewPlanItinVL1
     */
    public ViewLinkImpl getNewPlanItinVL1() {
        return (ViewLinkImpl) findViewLink("NewPlanItinVL1");
    }

    /**
     * Container's getter for FKLignetripsViewLink1.
     * @return FKLignetripsViewLink1
     */
    public ViewLinkImpl getFKLignetripsViewLink1() {
        return (ViewLinkImpl) findViewLink("FKLignetripsViewLink1");
    }

    /**
     * Container's getter for FkStopTripsViewLink1.
     * @return FkStopTripsViewLink1
     */
    public ViewLinkImpl getFkStopTripsViewLink1() {
        return (ViewLinkImpl) findViewLink("FkStopTripsViewLink1");
    }

    /**
     * Container's getter for FkStopTripsViewLink2.
     * @return FkStopTripsViewLink2
     */
    public ViewLinkImpl getFkStopTripsViewLink2() {
        return (ViewLinkImpl) findViewLink("FkStopTripsViewLink2");
    }

    /**
     * Container's getter for NewDritin1DrligneVL2.
     * @return NewDritin1DrligneVL2
     */
    public ViewLinkImpl getNewDritin1DrligneVL2() {
        return (ViewLinkImpl) findViewLink("NewDritin1DrligneVL2");
    }

    /**
     * Container's getter for FkTripsGroupViewLink.
     * @return FkTripsGroupViewLink
     */
    public ViewLinkImpl getFkTripsGroupViewLink() {
        return (ViewLinkImpl) findViewLink("FkTripsGroupViewLink");
    }

    /**
     * Container's getter for FkStopTripsViewLink3.
     * @return FkStopTripsViewLink3
     */
    public ViewLinkImpl getFkStopTripsViewLink3() {
        return (ViewLinkImpl) findViewLink("FkStopTripsViewLink3");
    }

    /**
     * Container's getter for FkGroupexpCentreVL.
     * @return FkGroupexpCentreVL
     */
    public ViewLinkImpl getFkGroupexpCentreVL() {
        return (ViewLinkImpl) findViewLink("FkGroupexpCentreVL");
    }

    /**
     * Container's getter for FkTripsGroupViewLink1.
     * @return FkTripsGroupViewLink1
     */
    public ViewLinkImpl getFkTripsGroupViewLink1() {
        return (ViewLinkImpl) findViewLink("FkTripsGroupViewLink1");
    }

    /**
     * Container's getter for FkStopTripsViewLink4.
     * @return FkStopTripsViewLink4
     */
    public ViewLinkImpl getFkStopTripsViewLink4() {
        return (ViewLinkImpl) findViewLink("FkStopTripsViewLink4");
    }

    /**
     * Container's getter for FkdelegdrligneViewLink.
     * @return FkdelegdrligneViewLink
     */
    public ViewLinkImpl getFkdelegdrligneViewLink() {
        return (ViewLinkImpl) findViewLink("FkdelegdrligneViewLink");
    }

    /**
     * Container's getter for FkVehicPlanexLink1.
     * @return FkVehicPlanexLink1
     */
    public ViewLinkImpl getFkVehicPlanexLink1() {
        return (ViewLinkImpl) findViewLink("FkVehicPlanexLink1");
    }

    /**
     * Container's getter for FkdaysplanVL.
     * @return FkdaysplanVL
     */
    public ViewLinkImpl getFkdaysplanVL() {
        return (ViewLinkImpl) findViewLink("FkdaysplanVL");
    }


    public void createTripsPlan(){
   
        
    }

    /**
     * Container's getter for DynamicVO1.
     * @return DynamicVO1
     */
    public ViewObjectImpl getDynamicVO1() {
        return (ViewObjectImpl) findViewObject("DynamicVO1");
    }

   


    
    public oracle.jbo.domain.Date castToJBODate(String aDate){
              DateFormat formatter;
              java.util.Date date;
     
              if(aDate!=null){
     
                try {
     
                  formatter = new SimpleDateFormat("dd/MM/yyyy");
                  date = formatter.parse(aDate);
                  java.sql.Date sqlDate = new java.sql.Date(date.getTime());
                  oracle.jbo.domain.Date jboDate = new oracle.jbo.domain.Date(sqlDate);
                System.out.println(jboDate);
                    return jboDate;
                   } catch (ParseException e) {
     
                            e.printStackTrace();
                    }
     
             }
     
             return null;
    }


    public Timestamp convertStringToTimestamp(String str_date) {
        try {
          DateFormat formatter;
          formatter = new SimpleDateFormat("HH:mm");
          //String fulldate="01/04/2016 "  +str_date;
          java.util.Date date = (java.util.Date) formatter.parse(str_date);
          java.sql.Timestamp timeStampDate = new Timestamp(date.getTime());

          return timeStampDate;
        } catch (ParseException e) {
          System.out.println("Exception :" + e);
          return null;
        }
      }
   
    public void changeDynamicVoQuery(String paramDate) {  
         EntityDefImpl tripsPlanDef = TripsplanImpl.getDefinitionObject();
         TripsplanImpl newTripsPlan  ;
        
        
         oracle.jbo.domain.Date dateplan =castToJBODate(paramDate);
        
         ViewObject dynamicVO = this.findViewObject("DynamicVO1");  
         dynamicVO.remove();  
         
         String sqlStatement ="select * from trips\n" + 
         "    where  NUM is not null and nvl(TRIP_ID,0) not in (select nvl(TRIP_ID,0) from TRIPSPLAN where DATEPLAN ='"+paramDate+"') and " +
         "    SERVICE_ID in (select SERVICE_ID from CALENDAR \n" + 
         "    where  (MONDAY=1 and to_char(to_date('"+paramDate+"','dd/mm/yyyy'),'d')=1)\n" + 
         "    or (TUESDAY=1 and to_char(to_date('"+paramDate+"','dd/mm/yyyy'),'d')=2)\n" + 
         "    or (WEDNESDAY=1 and to_char(to_date('"+paramDate+"','dd/mm/yyyy'),'d')=3)\n" + 
         "    or (THURSDAY=1 and to_char(to_date('"+paramDate+"','dd/mm/yyyy'),'d')=4)\n" + 
         "    or (FRIDAY=1 and to_char(to_date('"+paramDate+"','dd/mm/yyyy'),'d')=5)\n" + 
         "    or (SATURDAY=1 and to_char(to_date('"+paramDate+"','dd/mm/yyyy'),'d')=6)\n" + 
         "    or (SUNDAY=1 and to_char(to_date('"+paramDate+"','dd/mm/yyyy'),'d')=7))";
         
         
        
         dynamicVO = this.createViewObjectFromQueryStmt("DynamicVO1", sqlStatement);  
         dynamicVO.executeQuery();  
         
           System.out.println("sql  :" + sqlStatement);  
        
         while (dynamicVO.hasNext()) {  
             Row row = dynamicVO.next();  
             newTripsPlan = (TripsplanImpl)tripsPlanDef.createInstance2(getDBTransaction(), null);
             
             newTripsPlan.setDateplan(dateplan);
             newTripsPlan.setTypepl("R");
             newTripsPlan.setTripId((Integer)row.getAttribute("TRIP_ID"));
             newTripsPlan.setEtat("P");
             
             System.out.println("tripid  :" + row.getAttribute("TRIP_ID")+ " service :"+ row.getAttribute("SERVICE_ID"));
             
         }  
         
         //save data
         try {
               getDBTransaction().commit();
         } catch (Exception e) {
               e.printStackTrace();
         }      
                
       }

    public void getDynamicLocationQuery(String paramDate) {  
         EntityDefImpl tripsPlanDef = TripsplanImpl.getDefinitionObject();
         TripsplanImpl newTripsPlan  ;
        
        
         oracle.jbo.domain.Date dateplan =castToJBODate(paramDate);
        
         ViewObject dynamicVO = this.findViewObject("DynamicVO1");  
         dynamicVO.remove();  
                 
             
         String sqlStatement = "select * from DRDMDLOC where  etat in ('V','P') and '"+paramDate+"' between DATE_DEP and DATE_RET\n" + 
                               "and nvl(LOC_ID,0)  not in (select nvl(LOC_ID,0) from TRIPSPLAN where TRIPSPLAN.DATEPLAN ='"+paramDate+"')";       
        
         dynamicVO = this.createViewObjectFromQueryStmt("DynamicVO1", sqlStatement);  
         dynamicVO.executeQuery();  
         
           System.out.println("sql  :" + sqlStatement);  
        
         while (dynamicVO.hasNext()) {  
             Row row = dynamicVO.next();  
             newTripsPlan = (TripsplanImpl)tripsPlanDef.createInstance2(getDBTransaction(), null);
             
             newTripsPlan.setDateplan(dateplan);
             newTripsPlan.setTypepl("L");
             newTripsPlan.setLocId((Integer)row.getAttribute("LOC_ID"));
             newTripsPlan.setEtat("P");
             
             System.out.println("loc id  :" + row.getAttribute("LOC_ID"));
             //update etat location de l'etat Validé a l'etat Planifier
             updateEtatLocation((Integer)row.getAttribute("LOC_ID"),"P");
             
         }  
         
         
         //save data
         try {
               getDBTransaction().commit();
         } catch (Exception e) {
               e.printStackTrace();
         }      
                
       }
    /**
     * Container's getter for DrclienView1.
     * @return DrclienView1
     */
    public ViewObjectImpl getDrclienView1() {
        return (ViewObjectImpl) findViewObject("DrclienView1");
    }

    /**
     * Container's getter for DrdmdlocView1.
     * @return DrdmdlocView1
     */
    public DrdmdlocViewImpl getDrdmdlocView1() {
        return (DrdmdlocViewImpl) findViewObject("DrdmdlocView1");
    }

    /**
     * Container's getter for DrtyplocView1.
     * @return DrtyplocView1
     */
    public ViewObjectImpl getDrtyplocView1() {
        return (ViewObjectImpl) findViewObject("DrtyplocView1");
    }


    /**
     * Container's getter for DrdmdlocView3.
     * @return DrdmdlocView3
     */
    public DrdmdlocViewImpl getDrdmdlocView3() {
        return (DrdmdlocViewImpl) findViewObject("DrdmdlocView3");
    }


    /**
     * Container's getter for FkTyplocLink1.
     * @return FkTyplocLink1
     */
    public ViewLinkImpl getFkTyplocLink1() {
        return (ViewLinkImpl) findViewLink("FkTyplocLink1");
    }


    /**
     * Container's getter for DrtypecView1.
     * @return DrtypecView1
     */
    public ViewObjectImpl getDrtypecView1() {
        return (ViewObjectImpl) findViewObject("DrtypecView1");
    }

    /**
     * Container's getter for DrmouvView1.
     * @return DrmouvView1
     */
    public ViewObjectImpl getDrmouvView1() {
        return (ViewObjectImpl) findViewObject("DrmouvView1");
    }

    /**
     * Container's getter for ListProposedTripsView1.
     * @return ListProposedTripsView1
     */
    public ViewObjectImpl getListProposedTripsView1() {
        return (ViewObjectImpl) findViewObject("ListProposedTripsView1");
    }
    
    
    public void setBindVarsPropTrips(String vdebut, String  vfin, String vcentre)
    {
     System.out.println("***In setBindVars*****");
     ViewObject vo = findViewObject("ListProposedTripsView1");
     
     
     VariableValueManager vm = vo.ensureVariableManager();
     vm.setVariableValue("debut", vdebut);
     vm.setVariableValue("fin", vfin);
     vm.setVariableValue("centre", vcentre);
     
     vo.executeQuery();
    }
    
    public Integer addTrips(String vligne, Integer vservice, String vdirec, String vdepart , String varrive, String vheadsign , String vshortname, Integer vblock, Integer vgroup, String vHaveret ,String vTimeNret ){
           
        System.out.println(" 1 :" + vligne + " 2 "+vservice + " 3 "+ vdirec + " 4 " + vdepart + " 5 "+varrive+ " 6 :" + vheadsign + " 7 "+vshortname + " 8 "+ vblock + " 9 " + vgroup + " 10 "+vHaveret + " 11 "+ vTimeNret);
        TripsViewImpl trips = getTripsView4();
        TripsViewRowImpl tripsRow =(TripsViewRowImpl) trips.createRow();
        
        tripsRow.setDenumli(vligne);
        tripsRow.setServiceId(vservice);
        tripsRow.setDirectionId(vdirec);
        tripsRow.setTimeDepart(convertStringToTimestamp(vdepart));
        //tripsRow.setTimeReturn(convertStringToTimestamp(varrive));
        tripsRow.setTripHeadsign(vheadsign);
        tripsRow.setTripShortName(vshortname);
        tripsRow.setBlockId(vblock);
        tripsRow.setNum(vgroup);
        tripsRow.setHaveret(vHaveret);
        
        if (vHaveret.compareTo("O")==0){
            tripsRow.setTimeNret(convertStringToTimestamp(vTimeNret));
            System.out.println("time ret :" + vTimeNret);
        }
            
        
        
        trips.insertRow(tripsRow);
        
        
        //save data
        try {
              getDBTransaction().commit();
        } catch (Exception e) {
              e.printStackTrace();
        }  
        
        return ConvertDBSeqToInteger(tripsRow.getTripId());
        
        
    }
    
    public Integer ConvertDBSeqToInteger(DBSequence dbseq) {
        oracle.jbo.domain.Number dbSeqNumber = dbseq.getSequenceNumber();
        int dbSeqIntValue = dbSeqNumber.intValue();

        return new Integer(dbSeqIntValue);
    }
    
    public void recordPartHistory()
      {
        /*TripsViewImpl vo = getTripsView2();
        TripsViewRowImpl changed = (TripsViewRowImpl) vo.getCurrentRow();
        changed.getChangedAttributes();
        System.out.println("Changed: " + changed.getChangedAttributes());*/
        
          TripsViewImpl vo = getTripsView2();
              AttributeDef[] attr =
                vo.getCurrentRow().getStructureDef().getAttributeDefs();
              System.out.println(((AttributeDefImpl) attr[4]).getColumnName());
              System.out.println(((AttributeDefImpl) attr[4]).isDirty());
              System.out.println(vo.getCurrentRow().getAttribute("TimeDepart"));
      }
    
    
    public void updateGroupInTrips(DBSequence id, Integer grp){
        
       
              // create the key object
               Key key = new Key(new Object[] { id });
               TripsViewImpl vo = (TripsViewImpl)this.getTripsView1();
               //find the row using key reference in View Object.
               Row k=vo.getRow(key);
               //using this method we can set the new value to FirstName  
               System.out.println(" groupe last 1 :" + grp);
             //  if (grp == null) 
             //      k.setAttribute("Num", null);
             //  else
                   k.setAttribute("Num", grp);
               
               this.getDBTransaction().commit();
              System.out.println("the name is"+ k.getAttribute("Num"));
    }
    
    
    public void updateGroupInTripsLink(Integer id, Integer grp){
        
       
              // create the key object
               Key key = new Key(new Object[] { id });
               TripsViewImpl vo = (TripsViewImpl)this.getTripsView1();
               //find the row using key reference in View Object.
               Row k=vo.getRow(key);
               //using this method we can set the new value to FirstName  
               System.out.println(" groupe last 1 :" + grp);
              // if (grp == null) 
              //     k.setAttribute("Num", null);
              // else
                   k.setAttribute("Num", grp);
               
               this.getDBTransaction().commit();
              System.out.println("the name is"+ k.getAttribute("Num"));
    }
    public void updateGroupInTripsNull(DBSequence id){
        
       
              // create the key object
               Key key = new Key(new Object[] { id });
               TripsViewImpl vo = (TripsViewImpl)this.getTripsView3();
               //find the row using key reference in View Object.
               Row k=vo.getRow(key);
               //using this method we can set the new value to FirstName  
               
               k.setAttribute("Num", null);
               
               
               this.getDBTransaction().commit();
              System.out.println("the name is"+ k.getAttribute("Num"));
    }
    
    public void updateGroupInTripsNullLink(Integer id){
        
              System.out.println("trips nid : "+ id);
              // create the key object
               Key key = new Key(new Object[] { id });
               TripsViewImpl vo = (TripsViewImpl)this.getTripsView3();
               //find the row using key reference in View Object.
               Row k=vo.getRow(key);
               //using this method we can set the new value to FirstName  
               
               k.setAttribute("Num", null);
               
               
               this.getDBTransaction().commit();
              System.out.println("the name is"+ k.getAttribute("Num"));
    }
    
    public void updateEtatLocation(Integer id, String vetat){
        
       
              // create the key object
               Key key = new Key(new Object[] { id });
               DrdmdlocViewImpl vo = (DrdmdlocViewImpl)this.getDrdmdlocView1();
               //find the row using key reference in View Object.
               Row k=vo.getRow(key);
               //using this method we can set the new value to FirstName  
              
               System.out.println("Eat :"+ vetat);
               k.setAttribute("Etat", vetat);
               
               //this.getDBTransaction().commit();
              
    }

    /**
     * Container's getter for DrperioView1.
     * @return DrperioView1
     */
    public ViewObjectImpl getDrperioView1() {
        return (ViewObjectImpl) findViewObject("DrperioView1");
    }

    /**
     * Container's getter for DrdetprView1.
     * @return DrdetprView1
     */
    public ViewObjectImpl getDrdetprView1() {
        return (ViewObjectImpl) findViewObject("DrdetprView1");
    }

    /**
     * Container's getter for FkDrdetprRef10902DrperioLink1.
     * @return FkDrdetprRef10902DrperioLink1
     */
    public ViewLinkImpl getFkDrdetprRef10902DrperioLink1() {
        return (ViewLinkImpl) findViewLink("FkDrdetprRef10902DrperioLink1");
    }

    /**
     * Container's getter for GroupExpView3.
     * @return GroupExpView3
     */
    public ViewObjectImpl getGroupExpView3() {
        return (ViewObjectImpl) findViewObject("GroupExpView3");
    }

    /**
     * Container's getter for GroupExpFk1ViewLink1.
     * @return GroupExpFk1ViewLink1
     */
    public ViewLinkImpl getGroupExpFk1ViewLink1() {
        return (ViewLinkImpl) findViewLink("GroupExpFk1ViewLink1");
    }

    /**
     * Container's getter for DrmissView1.
     * @return DrmissView1
     */
    public ViewObjectImpl getDrmissView1() {
        return (ViewObjectImpl) findViewObject("DrmissView1");
    }

    /**
     * Container's getter for TypmissView1.
     * @return TypmissView1
     */
    public ViewObjectImpl getTypmissView1() {
        return (ViewObjectImpl) findViewObject("TypmissView1");
    }

    /**
     * Container's getter for DrmissView2.
     * @return DrmissView2
     */
    public ViewObjectImpl getDrmissView2() {
        return (ViewObjectImpl) findViewObject("DrmissView2");
    }

    /**
     * Container's getter for FkTypmissLink1.
     * @return FkTypmissLink1
     */
    public ViewLinkImpl getFkTypmissLink1() {
        return (ViewLinkImpl) findViewLink("FkTypmissLink1");
    }

    /**
     * Container's getter for TripsView5.
     * @return TripsView5
     */
    public TripsViewImpl getTripsView5() {
        return (TripsViewImpl) findViewObject("TripsView5");
    }

    /**
     * Container's getter for FkTripsplantripsAssocVL1.
     * @return FkTripsplantripsAssocVL1
     */
    public ViewLinkImpl getFkTripsplantripsAssocVL1() {
        return (ViewLinkImpl) findViewLink("FkTripsplantripsAssocVL1");
    }
    
    
    public void addMissPlan(String vdateMiss, Integer vidmiss ){
           
        TripsplanViewImpl plan = getTripsplanView2();
        TripsplanViewRowImpl planRow =(TripsplanViewRowImpl) plan.createRow();
        
        planRow.setDateplan(castToJBODate(vdateMiss));
        planRow.setIdMiss(vidmiss);
        planRow.setTypepl("M");        
        
        plan.insertRow(planRow);
        
        
        //save data
        try {
              getDBTransaction().commit();
        } catch (Exception e) {
              e.printStackTrace();
        }     
    }
    
    public void updateTripNid(Integer id, Integer nid){
        
       
              // create the key object
               Key key = new Key(new Object[] { id });
               TripsViewImpl vo = (TripsViewImpl)this.getTripsView2();
               //find the row using key reference in View Object.
               Row k=vo.getRow(key);
              
               System.out.println("update trips n :" + id + "  ref trip :"+nid);
               k.setAttribute("TripNid", nid);
               
               this.getDBTransaction().commit();
              
    }
    
    public void updateTripNid1(Integer id, Integer nid){
        
       
              // create the key object
               Key key = new Key(new Object[] { id });
               TripsViewImpl vo = (TripsViewImpl)this.getTripsView1();
               //find the row using key reference in View Object.
               Row k=vo.getRow(key);
              
               System.out.println("update trips n :" + id + "  ref trip :"+nid);
               k.setAttribute("TripNid", nid);
               
               this.getDBTransaction().commit();
              
    }
    
    public String createReturnTripsAM(Integer oldtrip,String oldligne,Integer oldServ,String headSign,String Shortname,String direc,String timeDepart, Integer vgrp){
        /*
         * EntityDefImpl trips =  TripsImpl.getDefinitionObject();

        TripsImpl newTrips = (TripsImpl) trips.createInstance2(getDBTransaction(), null);

        newTrips.setDenumli(oldligne);
        newTrips.setServiceId(oldServ);
        if (direc.compareTo("0")==0)
            newTrips.setDirectionId("1");
        else
            newTrips.setDirectionId("0");
        
        newTrips.setTripHeadsign(headSign);
        newTrips.setTripShortName(Shortname);
        
        newTrips.setTimeDepart(convertStringToTimestamp(timeDepart));
        newTrips.setHaveret("O");
        
        System.out.println("oldtrip return trips  :"+oldtrip);
        newTrips.setTripNid(oldtrip);
        
        newTrips.setNum(vgrp);
        
        this.getDBTransaction().commit();
        System.out.println(newTrips.getTripId().toString());
       
        
        */
        
        TripsViewImpl tr = getTripsView1();
        TripsViewRowImpl trRow =(TripsViewRowImpl) tr.createRow();
        
        
        
        trRow.setDenumli(oldligne);
        trRow.setServiceId(oldServ);
        if (direc.compareTo("0")==0)
            trRow.setDirectionId("1");
        else
            trRow.setDirectionId("0");
        
        trRow.setTripHeadsign(headSign);
        trRow.setTripShortName(Shortname);
        
        trRow.setTimeDepart(convertStringToTimestamp(timeDepart));
        trRow.setHaveret("O");
        
        System.out.println("oldtrip return trips  :"+oldtrip);
        trRow.setTripNid(oldtrip);
        
        trRow.setNum(vgrp);
        
        tr.insertRow(trRow);
        
        //save data
        try {
              getDBTransaction().commit();
        } catch (Exception e) {
              e.printStackTrace();
        }     
        
        return trRow.getTripId().toString();
    }


    /**
     * Container's getter for RealtimeView1.
     * @return RealtimeView1
     */
    public ViewObjectImpl getRealtimeView1() {
        return (ViewObjectImpl) findViewObject("RealtimeView1");
    }

    /**
     * Container's getter for JsonLigneView1.
     * @return JsonLigneView1
     */
    public ViewObjectImpl getJsonLigneView1() {
        return (ViewObjectImpl) findViewObject("JsonLigneView1");
    }

    /**
     * Container's getter for ListBusGPSView1.
     * @return ListBusGPSView1
     */
    public ViewObjectImpl getListBusGPSView1() {
        return (ViewObjectImpl) findViewObject("ListBusGPSView1");
    }


    /**
     * Container's getter for TripsView7.
     * @return TripsView7
     */
    public TripsViewImpl getTripsView7() {
        return (TripsViewImpl) findViewObject("TripsView7");
    }

    /**
     * Container's getter for FkStopTripsViewLink6.
     * @return FkStopTripsViewLink6
     */
    public ViewLinkImpl getFkStopTripsViewLink6() {
        return (ViewLinkImpl) findViewLink("FkStopTripsViewLink6");
    }

    /**
     * Container's getter for StopTimesView6.
     * @return StopTimesView6
     */
    public ViewObjectImpl getStopTimesView6() {
        return (ViewObjectImpl) findViewObject("StopTimesView6");
    }

    /**
     * Container's getter for FkStopTripsViewLink5.
     * @return FkStopTripsViewLink5
     */
    public ViewLinkImpl getFkStopTripsViewLink5() {
        return (ViewLinkImpl) findViewLink("FkStopTripsViewLink5");
    }


    /**
     * Container's getter for Drdep2View5.
     * @return Drdep2View5
     */
    public ViewObjectImpl getDrdep2View1() {
        return (ViewObjectImpl) findViewObject("Drdep2View1");
    }

    /**
     * Container's getter for fkrealTimedrdep2LLink1.
     * @return fkrealTimedrdep2LLink1
     */
    public ViewLinkImpl getfkrealTimedrdep2LLink1() {
        return (ViewLinkImpl) findViewLink("fkrealTimedrdep2LLink1");
    }

    /**
     * Container's getter for TripsplanView4.
     * @return TripsplanView4
     */
    public TripsplanViewImpl getTripsplanView4() {
        return (TripsplanViewImpl) findViewObject("TripsplanView4");
    }

    /**
     * Container's getter for FkrealtimeTripplanLink1.
     * @return FkrealtimeTripplanLink1
     */
    public ViewLinkImpl getFkrealtimeTripplanLink1() {
        return (ViewLinkImpl) findViewLink("FkrealtimeTripplanLink1");
    }

    /**
     * Container's getter for TripsView6.
     * @return TripsView6
     */
    public TripsViewImpl getTripsView6() {
        return (TripsViewImpl) findViewObject("TripsView6");
    }

    /**
     * Container's getter for FkTripsplantripsAssocVL2.
     * @return FkTripsplantripsAssocVL2
     */
    public ViewLinkImpl getFkTripsplantripsAssocVL2() {
        return (ViewLinkImpl) findViewLink("FkTripsplantripsAssocVL2");
    }

    /**
     * Container's getter for StopTimesView7.
     * @return StopTimesView7
     */
    public ViewObjectImpl getStopTimesView7() {
        return (ViewObjectImpl) findViewObject("StopTimesView7");
    }

    /**
     * Container's getter for ListStationPlan1.
     * @return ListStationPlan1
     */
    public ListStationPlanImpl getListStationPlan1() {
        return (ListStationPlanImpl) findViewObject("ListStationPlan1");
    }
}

